// JavaScript Document

	domReady(function(){
		var oSide = document.getElementById('side');
		var aMovie_moreMsg = getByClass(oSide,'movie_moreMsg');
		var oMovieBox_msg = getByClass(oSide,'movieBox_msg');
		var oVideoGallery = document.getElementById('videoGallery');
		var oRollBox = document.getElementById('rollBox');
		var oRollBar = getChild(oRollBox).first;
		var oParent = oRollBox.parentNode;
		var oLast = getChild(oParent).last;
		var oFirst = getChild(oRollBox).first;
		
		var oPlayerIndexFocus = document.getElementById('playerIndexFocus');
		var oFi_ct = getByClass(oPlayerIndexFocus,'fi_ct')[0];
		var aLi_ct = oFi_ct.getElementsByTagName('li');
		var oFi_tab = getByClass(oPlayerIndexFocus,'fi_tab')[0];
		var aBtn_tab = oFi_tab.getElementsByTagName('li');
		var oFi_pointer = getByClass(oFi_tab,'fi_pointer')[0];
		
		var oContent = document.getElementById('content');
		var oRollBox2 = document.getElementById('rollBox2');
		var oRollBar2 = getByClass(oRollBox2,'rollBar')[0];
		var oScroll_content = document.getElementById('scroll_content');
		var aMaskVideo = getByClass(oContent,'maskVideo');
		
		for(var i=0; i<aMovie_moreMsg.length; i++){
			aMovie_moreMsg[i].index = i;
			var oBtn = getChild(aMovie_moreMsg[i].children[0]).last;
			oBtn.iNow = 0;
			var oDiv = aMovie_moreMsg[i].children[1];
			var oSpan = aMovie_moreMsg[i].children[0].children[0];
			play(oBtn,oDiv);
			toMove(oSpan);
			if(aMovie_moreMsg[i].children[0].children[0].innerHTML == '-'){
				aMovie_moreMsg[i].onmouseenter = function(){
					var _this = this;
					clearInterval(getChild(_this.children[0]).last.timer);
				};
				aMovie_moreMsg[i].onmouseleave = function(){
					var oBtn = getChild(this.children[0]).last;
					var oDiv = getSibling(oBtn.parentNode).next;
					if(this.children[0].children[0].innerHTML == '-'){
						play(oBtn,oDiv);
					}else{
						clearInterval(oBtn.timer);
					}
				};
			}
		}
		addEvent(oVideoGallery,'mouseover',movie_rankActive);
		rollBox();
		addWheel(oLast,wheelMove);
		addWheel(oScroll_content,wheelMove2);
		
		for(var i=0; i<aMaskVideo.length; i++){
			aMaskVideo[i].parentNode.onmouseover = function(){
				this.children[1].style.display = 'block';
			};
			aMaskVideo[i].parentNode.onmouseout = function(){
				this.children[1].style.display = 'none';
			};
		}
		//main下fi_tab移动
		for(var i=0; i<aBtn_tab.length; i++){
			aBtn_tab[i].index = i;
			aBtn_tab[i].onmouseover = function(){
				for(var i=0; i<aBtn_tab.length; i++){
					var Li_ct =  aLi_ct[i];
					move(Li_ct,{opacity:0},{complete:function(){
						Li_ct.style.display = 'none';
					}});
				}
				oFi_pointer.style.left = this.index*oFi_pointer.offsetWidth + 'px';
				aLi_ct[this.index].style.display = 'block';
				move(aLi_ct[this.index],{opacity:100});
			}
		}
		//鼠标滚动1
		function wheelMove(flag){
			var nT = oRollBar.offsetTop;
			if(flag){
				nT += 10;
			}else{
				nT -= 10;
			}
			setTop(nT);
		}
		//鼠标滚动2
		function wheelMove2(flag){
			var nT = oRollBar2.offsetTop;
			if(flag){
				nT += 10;
			}else{
				nT -= 10;
			}
			setTop2(nT);
		}
		//滚动条拖动
		oRollBar.onmousedown = function(ev){
			var oEvent = ev || event;
			var disY = oEvent.clientY - oRollBar.offsetTop;
			document.onmousemove = function(ev){
				var oEvent = ev || event;
				var t = oEvent.clientY - disY;
				setTop(t);
				
			};
			document.onmouseup = function(){
				document.onmousemove = null;
				document.onmouseup = null;
				oRollBar.releaseCapture && oRollBar.releaseCapture();
			};
			oRollBar.setCapture && oRollBar.setCapture();
			return false;
		}
		function setTop(t){
			if(t<13) t = 13;
			if(t>oRollBox.offsetHeight - oRollBar.offsetHeight - 13){
				t = oRollBox.offsetHeight - oRollBar.offsetHeight - 13;
			}
			oRollBar.style.top = t + 'px';
			var scale = (t-13)/(oRollBox.offsetHeight - oRollBar.offsetHeight-26);
			oLast.style.top = -(oLast.offsetHeight - oParent.offsetHeight)*scale+'px';
		}
		//滚动条拖动2
		oRollBar2.onmousedown = function(ev){
			var oEvent = ev || event;
			var disY = oEvent.clientY - oRollBar2.offsetTop;
			document.onmousemove = function(ev){
				var oEvent = ev || event;
				var t = oEvent.clientY - disY;
				setTop2(t);
				
			};
			document.onmouseup = function(){
				document.onmousemove = null;
				document.onmouseup = null;
				oRollBar2.releaseCapture && oRollBar2.releaseCapture();
			};
			oRollBar2.setCapture && oRollBar2.setCapture();
			return false;
		}
		function setTop2(t){
			if(t<16) t = 16;
			if(t>oRollBox2.offsetHeight - oRollBar2.offsetHeight - 16){
				t = oRollBox2.offsetHeight - oRollBar2.offsetHeight - 16;
			}
			oRollBar2.style.top = t + 'px';
			var scale = (t-16)/(oRollBox2.offsetHeight - oRollBar2.offsetHeight-32);
			oScroll_content.style.top = -(oScroll_content.offsetHeight - oContent.offsetHeight)*scale+'px';
		}
		//  计算滚动条1
		function rollBox(){
			if(oLast.offsetHeight > oParent.offsetHeight){
				oFirst.style.display = 'block';
				oFirst.style.height = oParent.offsetHeight*oRollBox.offsetHeight/oLast.offsetHeight + 'px';
			}else{
				oFirst.style.display = 'none';
			}
		}
		//选项卡内部隐藏显示
		function movie_rankActive(ev){
			var oEvent = ev || event;
			var target = oEvent.target || oEvent.srcElement;
			
			if(target.className == 'movie_rankone'){
				var oDiv = target.parentNode.parentNode;
				for(var i=0; i<oDiv.children.length; i++){
					oDiv.children[i].children[0].style.display = 'block';
					oDiv.children[i].children[1].style.display = 'none';
				}
				target.style.display = 'none';
				getSibling(target).next.style.display = 'block';
			}
		}
			//play选项卡
		function play(btn,obj){
			clearInterval(btn.timer);
            for(var i = 0; i<btn.children.length; i++){
                btn.children[i].index = i;
                btn.children[i].onclick = function(){
                    btn.iNow = this.index;
                    tab();
                };
            }
			function tab(){
                for(var i = 0; i< btn.children.length; i++){
                    btn.children[i].className = '';
                    obj.children[i].style.display = 'none';
                }
                btn.children[btn.iNow].className = 'active';
                obj.children[btn.iNow].style.display = 'block';
            }
			 function next(){
                btn.iNow++;
                if (btn.iNow >= btn.children.length){
                   btn.iNow = 0;
                }
                tab();
            };
            btn.timer = setInterval(next,2000);
		}
			//show 选项卡父级运动
		function toMove(obj){
			obj.onclick = function(){
				var oDiv = obj.parentNode.parentNode;
				var L1 = obj.parentNode.offsetHeight;
				var L2 = L1 + (obj.parentNode.nextElementSibling || obj.parentNode.nextSibling).offsetHeight;
				if(obj.innerHTML == '+'){
					move(oDiv,{height:L2});
					obj.innerHTML = '-';
					rollBox();
				}else{
					move(oDiv,{height:L1});
					obj.innerHTML = '+';
					rollBox();
					var oBtn = this.parentNode.lastElementChild;
					clearInterval(oBtn.timer)
				}
			};
		}
	});